import{d as M,t as P,s as W,r as v,S as X,o as y,c as k,U as Y,V as Z,e as D,w as h,b as j,W as H,X as Q,u as p,Y as ee,Z as te,a as O,f as ne,h as oe,i as ae,n as le,$ as ie}from"../../index.0FToouit.js";import{u as de}from"../../../../common/settings-store.-U_xgh6L.js";import{_ as ue}from"../../../../common/DataTableControl.vue_vue_type_script_setup_true_lang.NU6umRA0.js";import{B as se}from"../../../../common/index.DuahDua_.js";/* empty css                                                                                      */import{_ as re}from"../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../common/GroupEditFields.vue_vue_type_script_setup_true_lang.BHnpEQ8A.js";import"../../../../common/index.9myCtLWz.js";import"../../../../common/FormItemContext.CqVJozov.js";import"../../../../common/createContext.DswTPIOS.js";import"../../../../common/statusUtils.fyn02DMp.js";import"../../../../common/motion.EdENdc_P.js";import"../../../../common/SearchOutlined.03_Rn6S4.js";import"../../../../common/compact-item.CBELd0YD.js";import"../../../../common/index.CJHWgkCV.js";import"../../../../common/isPlainObject.DqIkjRjv.js";import"../../../../common/index.u8fchTh8.js";import"../../../../common/index.BBSQqZBe.js";import"../../../../common/KeyCode.B_gOgbN6.js";import"../../../../common/pickAttrs.C4jbNTpE.js";import"../../../../common/slide.C3sR3tWs.js";import"../../../../common/isMobile.WcF_19Ab.js";import"../../../../common/useMergedState.CeRJTcTW.js";import"../../../../common/useState.DjxQpG1z.js";import"../../../../common/DownOutlined.DUQyvKP0.js";import"../../../../common/index.Dzg1kzGK.js";import"../../../../common/index.Cc7blb_p.js";import"../../../../common/index.BTvIsX50.js";import"../../../../common/warning.CrM1WiW4.js";import"../../../../common/index.CL4_wdF3.js";import"../../../../common/index.orUix1Mb.js";import"../../../../common/ActionButton.CpaivzRg.js";import"../../../../common/EditOutlined.KbemwFb1.js";import"../../../../common/DeleteOutlined.BPTeAZVG.js";import"../../../../common/index.1EK9wRFW.js";import"../../../../common/index.CHOsJRCc.js";import"../../../../common/index.BLSGQKo4.js";import"../../../../common/Checkbox.CG5oI9Sy.js";import"../../../../common/index.DZxE9LJP.js";import"../../../../common/debounce.-jketAQO.js";const fe=["id"],pe={class:"data-table-buttons"},ce={class:"data-table"},ve=M({__name:"GroupControl",props:{params:{type:Object,required:!0},conditionalValues:{type:Object,required:!1,default:()=>({})}},emits:["input","fieldData","selectedCondition","conditionalData","selectedDependent","fieldUpdatedData","fieldUpdatedPopupData"],setup(S,{emit:x}){var C,V;const B=S,{params:F}=P(B),I=de(),{selectedConditionKey:K,selectedConditionValue:U,groupData:r}=W(I),A=x,s=F.value,N=s.classes,c=s.id,d=v(s.fields),f=X({fields:d.value}),u=v(s.table.data),w=s.group_action,q=v((V=(C=s.table)==null?void 0:C.inline_edit)!=null?V:!0),m=v(!1),l=v([]),g=v([]);if(typeof r.value<"u"&&Object.keys(r.value).length>0&&typeof r.value[c]<"u"&&(u.value=r.value[c]),f.fields)for(const[a,o]of Object.entries(f.fields)){const t=o;l.value[t.id]=t.default}const E=a=>{Object.entries(a).forEach(([o,t])=>{l.value[o]=t})};typeof d.value<"u"&&d.value!==null&&(f.fields=d.value.filter(a=>typeof a.hide<"u"&&a.hide!==null?!a.hide:!0));const G=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{if(typeof n.condition<"u"&&n.condition!==null){const e=n.condition.find(i=>i.key===o);return e.value==="yes"&&t==="yes"?!0:e.value==="no"&&t==="no"}else return!0}),g.value[o]=t},R=a=>{Object.assign(u.value.filter(o=>a.key===o.key)[0],a),r.value[c]=u.value},$=a=>{u.value=u.value.filter(o=>o.key!==a),r.value[c]=u.value},L=a=>{let o="",t="";for(const[n,e]of Object.entries(a)){let i=e;o=n,t=i}f.fields=d.value.filter(n=>{const e=d.value.find(i=>i.id===n.id);if(e)if(typeof e.condition<"u"&&e.condition!==null){const i=e.condition.find(_=>_.key===o);return typeof i<"u"&&i.key===o&&(!Array.isArray(i.value)&&i.value===t||Array.isArray(i.value)&&i.value.includes(t))?(typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0):!1}else return typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0;else return!1})},T=a=>{f.fields=d.value.filter(o=>{const t=d.value.find(n=>n.id===o.id);return t?typeof t.hide<"u"&&t.hide!==null&&t.hide?!1:(typeof l.value[t.id]<"u"&&l.value[t.id]!==null&&(o.default=l.value[t.id]),typeof t.dependent_option<"u"&&t.dependent_option!==null&&(o.default=t.dependent_default),!0):!1})},z=async()=>{m.value=!0;const a=[{key:"action",value:w}],o={};let t=0;if(u.value.length>0){let n=u.value.map(i=>i.key);t=Math.max(...n)+1}o.key=t;for(const[n,e]of Object.entries(l.value)){let i=e;typeof e=="object"&&e!==null&&(i=JSON.stringify(e)),a.push({key:n,value:i});let _=e;const b=d.value.find(J=>J.id===n);typeof b<"u"&&typeof b.prefix<"u"&&(_=b.prefix+e),o[n]=_}l.value=[];try{await ie(a)==="success"&&(u.value.push(o),r.value[c]=u.value,K.value="",U.value="",q.value||A("fieldUpdatedData",o)),m.value=!1}catch(n){console.error(n)}finally{m.value=!1}};return(a,o)=>(y(),k("div",{id:p(c),class:le(p(N))},[(y(!0),k(Y,null,Z(f.fields,(t,n)=>(y(),k("div",{key:n},[(y(),D(te,null,{fallback:h(()=>[j(H)]),default:h(()=>[(y(),D(Q(p(ee)(t.type)),{params:t,"conditional-values":g.value,onFieldData:E,onConditionalData:G,onSelectedCondition:L,onSelectedDependent:T},null,40,["params","conditional-values"]))]),_:2},1024))]))),128)),O("div",pe,[p(s).button_label!==""?(y(),D(p(se),{key:0,type:"primary",class:"save-group-btn",loading:m.value,onClick:z},{default:h(()=>[ne(oe(p(s).button_label),1)]),_:1},8,["loading"])):ae("",!0)]),O("div",ce,[j(ue,{params:p(s).table,data:u.value,"edit-fields":d.value,onFieldUpdatedData:R,onFieldDeletedData:$},null,8,["params","data","edit-fields"])])],10,fe))}}),tt=re(ve,[["__scopeId","data-v-ac0e52be"]]);export{tt as default};
