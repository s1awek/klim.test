import{d as P,t as G,s as H,S as b,r as m,c as n,o as r,a as c,b as y,U as u,V as k,i as v,u as l,w as g,n as J,f as p,h,e as Q,$ as w}from"../../index.CgAnrKTY.js";import{u as W}from"../../../../common/settings-store.CStolcjv.js";import{d as X}from"../../../../common/DnDDataTableControl.vue_vue_type_style_index_0_scoped_0b913e4f_lang.DCZvawc5.js";import{E as Y}from"../../../../common/EditOutlined.SQdQMKEd.js";import{D as Z}from"../../../../common/DeleteOutlined.DEESpwPE.js";import{A as ee}from"../../../../common/index.CebwfPXl.js";import{_ as te}from"../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../common/index.DuShWVO-.js";import"../../../../common/motion.DFl2XAqn.js";import"../../../../common/index.D1hGdZRi.js";import"../../../../common/index.BgJXU5tk.js";import"../../../../common/useState.C1Qy7mgI.js";import"../../../../common/warning.CrM1WiW4.js";import"../../../../common/compact-item.D-XL5rIa.js";import"../../../../common/createContext.DahAGUWl.js";import"../../../../common/useMergedState.BM8MPfP9.js";import"../../../../common/KeyCode.c8YLmrmC.js";import"../../../../common/ActionButton.B4jE3wyd.js";const ae={class:"wwp-full-width-table"},oe={class:"thead-dark"},se={key:0,class:"editable-row-operations"},re={key:0,class:"editable-cell"},ne=["onClick"],ie=P({__name:"DnDDataTableControl",props:{params:{type:Object,required:!0},data:{type:Object,required:!0},editFields:{type:Object,required:!1,default:()=>({})},editedFields:{type:Number,required:!1,default:0}},emits:["fieldUpdatedData","fieldDeletedData","updateDataSource"],setup(C,{emit:S}){const V=C,{params:A,data:E,editedFields:O}=G(V),T=W(),{inlineMappingEdit:q}=H(T),d=A.value,B=d.fields,i=b({data:window.lodash.sortBy(E.value,t=>typeof t.field_order<"u"&&t.field_order!==null?t.field_order:0)}),N=d.editable,F=d.can_delete,R=d.delete_action,U=d.sort_action,j=m(d.show_in_table),x=m(!1),_=b([]),$=O,f=S,D=m([]),I=t=>{_[t]=window.lodash.cloneDeep(i.data.filter(o=>t===o.key)[0]),D.value=_[t],q.value=!1,f("fieldUpdatedData",D.value)},L=async t=>{const o=i.data.filter(a=>t===a.key)[0],e=[{key:"action",value:R}];for(const[a,s]of Object.entries(o))e.push({key:a,value:s});try{await w(e)==="success"&&(f("fieldDeletedData",t),i.data=i.data.filter(s=>s.key!==t))}catch(a){console.error(a)}finally{x.value=!1}},z=t=>Array.isArray(t)?t.join(", "):t,K=async t=>{const o=[{key:"action",value:U}],e="list",a=i.data;o.push({key:e,value:a});try{const s=await w(o,!1,!0);typeof s<"u"&&s!==null&&f("updateDataSource",s)}catch(s){console.error(s)}finally{}};return(t,o)=>(r(),n("table",ae,[c("thead",oe,[c("tr",null,[(r(!0),n(u,null,k(l(B),(e,a)=>(r(),n("th",{key:a,scope:"col"},v(e.title),1))),128))])]),y(l(X),{modelValue:i.data,"onUpdate:modelValue":o[0]||(o[0]=e=>i.data=e),tag:"tbody","item-key":"name",onEnd:K},{item:g(({element:e})=>[c("tr",{class:J({"not-draggable":!(e!=null&&e.draggable)})},[(r(!0),n(u,null,k(j.value,(a,s)=>(r(),n("td",{key:s,scope:"row"},[a==="operation"?(r(),n("div",se,[l($)===null?(r(),n("div",re,[l(N)?(r(),n("a",{key:0,onClick:M=>I(e.key)},[y(l(Y))],8,ne)):p("",!0),o[1]||(o[1]=h(" Â  ")),l(F)&&(e==null?void 0:e.deletetable)!=="no"?(r(),n(u,{key:1},[i.data.length?(r(),Q(l(ee),{key:0,title:"Sure to delete?",onConfirm:M=>L(e.key)},{default:g(()=>[c("a",null,[y(l(Z))])]),_:2},1032,["onConfirm"])):p("",!0)],64)):p("",!0)])):p("",!0)])):(r(),n(u,{key:1},[h(v(z(e[a])),1)],64))]))),128))],2)]),_:1},8,["modelValue"])]))}}),Ve=te(ie,[["__scopeId","data-v-0b913e4f"]]);export{Ve as default};
